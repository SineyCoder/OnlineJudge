webpackJsonp([10],{Fwyl:function(e,t){},"J/k1":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("zpbR"),o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"rightSetting"},[a("el-tabs",{attrs:{type:"border-card"}},[a("el-tab-pane",[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-file-picture-o"}),e._v("头像")]),e._v(" "),a("div",{staticStyle:{position:"relative",top:"50px","margin-left":"auto","margin-right":"auto",width:"300px"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.image_loading,expression:"image_loading"}],staticStyle:{width:"300px",height:"300px","margin-bottom":"10px",border:"1px solid black"}},[a("img",{staticStyle:{width:"300px",height:"300px","max-width":"100%"},attrs:{src:e.imageUrl,id:"image_"},on:{load:e.imageLoad}})]),e._v(" "),a("form",{attrs:{enctype:"multipart/form-data",id:"uploadForm"}},[a("input",{staticStyle:{width:"0px",height:"0px",opacity:"0"},attrs:{id:"upload",type:"file",name:"file"}})]),e._v(" "),a("button",{staticStyle:{display:"none"},attrs:{id:"tmpbtn"},on:{click:e.upload}}),e._v(" "),a("div",{staticClass:"pull-left"},[a("el-button",{staticStyle:{width:"140px",height:"34px"},attrs:{id:"uploadBtn",size:"medium"},on:{click:e.onloadBtn}},[e._v("上传")])],1),e._v(" "),a("div",{staticClass:"pull-right"},[a("el-button",{staticStyle:{width:"140px",height:"34px"},attrs:{type:"info",id:"saveBtn",size:"medium",disabled:""},on:{click:e.saveBtn}},[e._v("保存")])],1)])]),e._v(" "),a("el-tab-pane",[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-child"}),e._v(" 用户名")]),e._v(" "),a("div",{staticStyle:{width:"350px","text-align":"center",position:"relative",top:"120px","margin-left":"auto","margin-right":"auto"}},[a("div",{staticStyle:{"font-size":"large","margin-bottom":"20px",color:"#58666E"}},[a("strong",[e._v("修改用户名")])]),e._v(" "),a("div",[a("el-form",{ref:"username",attrs:{"status-icon":"",model:e.username.form,rules:e.username.rules}},[a("el-form-item",{attrs:{prop:"name"}},[a("el-input",{attrs:{placeholder:"新用户名",disabled:e.username.form.disabled},model:{value:e.username.form.name,callback:function(t){e.$set(e.username.form,"name",t)},expression:"username.form.name"}})],1)],1)],1),e._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"success",disabled:e.username.form.disabled},on:{click:e.saveUsername}},[e._v("保存")])],1),e._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-alert",{attrs:{closable:!1,title:e.username.form.attention,type:"warning"}})],1)])]),e._v(" "),a("el-tab-pane",[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-user"}),e._v(" 个人资料")]),e._v(" "),a("div",{staticStyle:{width:"400px","text-align":"center",position:"relative","margin-left":"auto","margin-right":"auto",top:"40px","box-shadow":"#444 0px 0px 3px"}},[a("div",{staticStyle:{padding:"10px","background-color":"#23B7E5",color:"#F0E9E7","font-size":"large"}},[e._v("\n          修改个人资料\n        ")]),e._v(" "),a("el-form",{ref:"info",attrs:{"label-position":"right","label-width":"70px","status-icon":"",model:e.info.form,rules:e.info.rules}},[a("div",{staticStyle:{padding:"10px"}},[a("div",{staticStyle:{"margin-bottom":"10px"}},[a("el-switch",{attrs:{"active-text":"启动修改","inactive-text":"关闭修改","active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.info.switch,callback:function(t){e.$set(e.info,"switch",t)},expression:"info.switch"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"infoRealName",label:"真实姓名"}},[a("el-input",{attrs:{disabled:!e.info.switch,maxlength:10},model:{value:e.info.form.infoRealName,callback:function(t){e.$set(e.info.form,"infoRealName",t)},expression:"info.form.infoRealName"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"infoSchoolName",label:"学校"}},[a("el-cascader",{staticStyle:{width:"100%"},attrs:{"expand-trigger":"hover",options:e.options2,"show-all-levels":!1,disabled:!e.info.switch,size:"medium"},model:{value:e.info.form.infoSchoolName,callback:function(t){e.$set(e.info.form,"infoSchoolName",t)},expression:"info.form.infoSchoolName"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"infoPhone",label:"手机"}},[a("el-input",{attrs:{disabled:!e.info.switch,maxlength:11},model:{value:e.info.form.infoPhone,callback:function(t){e.$set(e.info.form,"infoPhone",t)},expression:"info.form.infoPhone"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"infoGender",label:"性别"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"性别",disabled:!e.info.switch},model:{value:e.info.form.infoGender,callback:function(t){e.$set(e.info.form,"infoGender",t)},expression:"info.form.infoGender"}},e._l(e.options1,function(e){return a("el-option",{key:e.key,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{prop:"infoBlog",label:"博客"}},[a("el-input",{attrs:{disabled:!e.info.switch},model:{value:e.info.form.infoBlog,callback:function(t){e.$set(e.info.form,"infoBlog",t)},expression:"info.form.infoBlog"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"infoGithub",label:"Github"}},[a("el-input",{attrs:{disabled:!e.info.switch},model:{value:e.info.form.infoGithub,callback:function(t){e.$set(e.info.form,"infoGithub",t)},expression:"info.form.infoGithub"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"infoMotto",label:"个人签名"}},[a("el-input",{attrs:{disabled:!e.info.switch},model:{value:e.info.form.infoMotto,callback:function(t){e.$set(e.info.form,"infoMotto",t)},expression:"info.form.infoMotto"}})],1),e._v(" "),a("div",[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",size:"large",disabled:!e.info.switch},on:{click:function(t){e.updateInfo("info")}}},[e._v("修改")])],1)],1)])],1)]),e._v(" "),a("el-tab-pane",[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-envelope-o"}),e._v(" 邮箱")]),e._v(" "),a("div",{staticStyle:{width:"330px","text-align":"center",position:"relative","margin-left":"auto","margin-right":"auto",top:"50px","box-shadow":"#444 0px 0px 3px"}},[a("div",{staticStyle:{padding:"10px","background-color":"#23B7E5",color:"#F0E9E7","font-size":"large"}},[e._v("\n          修改邮箱\n        ")]),e._v(" "),a("el-form",{ref:"email",attrs:{"label-position":"right","label-width":"80px","status-icon":"",model:e.email.form,rules:e.email.rules}},[a("div",{staticStyle:{padding:"10px"}},[a("el-form-item",{attrs:{label:"目前邮箱"}},[a("el-input",{attrs:{value:e.user.userEmail,disabled:!0}})],1),e._v(" "),a("el-form-item",{attrs:{label:"修改邮箱",prop:"userEmail"}},[a("el-input",{model:{value:e.email.form.userEmail,callback:function(t){e.$set(e.email.form,"userEmail",t)},expression:"email.form.userEmail"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"验证码",prop:"captcha"}},[a("el-col",{attrs:{span:14}},[a("el-input",{model:{value:e.email.form.captcha,callback:function(t){e.$set(e.email.form,"captcha",t)},expression:"email.form.captcha"}})],1),e._v(" "),a("el-col",{attrs:{span:10}},[a("a",{attrs:{href:"javascript:void(0);"}},[a("img",{attrs:{src:e.captcha,alt:"none"},on:{click:e.changeCaptcha}})])])],1),e._v(" "),a("div",[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",size:"large"},on:{click:function(t){e.updateEmail("email")}}},[e._v("修改")])],1)],1)])],1)]),e._v(" "),a("el-tab-pane",[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-key"}),e._v("密码")]),e._v(" "),a("div",{staticStyle:{width:"330px","text-align":"center",position:"relative","margin-left":"auto","margin-right":"auto",top:"50px","box-shadow":"#444 0px 0px 3px"}},[a("div",{staticStyle:{padding:"10px","background-color":"#23B7E5",color:"#F0E9E7","font-size":"large"}},[e._v("\n          修改密码\n        ")]),e._v(" "),a("el-form",{ref:"pwd",attrs:{"label-position":"right","label-width":"70px","status-icon":"",model:e.pwd.form,rules:e.pwd.rules}},[a("div",{staticStyle:{padding:"10px"}},[a("el-form-item",{attrs:{prop:"oldPassword",label:"旧密码"}},[a("el-input",{attrs:{type:"password"},model:{value:e.pwd.form.oldPassword,callback:function(t){e.$set(e.pwd.form,"oldPassword",t)},expression:"pwd.form.oldPassword"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"password",label:"新密码"}},[a("el-input",{attrs:{type:"password"},model:{value:e.pwd.form.password,callback:function(t){e.$set(e.pwd.form,"password",t)},expression:"pwd.form.password"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"password_",label:"再次输入"}},[a("el-input",{attrs:{type:"password"},model:{value:e.pwd.form.password_,callback:function(t){e.$set(e.pwd.form,"password_",t)},expression:"pwd.form.password_"}})],1),e._v(" "),a("div",[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",size:"large"},on:{click:function(t){e.updatePassword("pwd")}}},[e._v("修改")])],1)],1)])],1)])],1)],1)},staticRenderFns:[]};var r=function(e){a("Fwyl")},i=a("VU/8")(s.a,o,!1,r,null,null);t.default=i.exports},mvHQ:function(e,t,a){e.exports={default:a("qkKv"),__esModule:!0}},qkKv:function(e,t,a){var s=a("FeBl"),o=s.JSON||(s.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}},zpbR:function(e,t,a){"use strict";(function(e){var s,o=a("mvHQ"),r=a.n(o),i=a("Dd8w"),n=a.n(i),l=a("rwyn"),m=(a.n(l),a("5SB6")),p=a("NYxO"),c=a("YtJ0"),u={x:0,y:0,w:0,h:0};t.a={store:c.a,name:"",components:{Cropper:m.a},data:function(){var e=this;return{loading:!0,captcha:"http://"+this.$HOST+"/common/captcha?"+100*Math.random(),options1:[{value:"man",label:"男"},{value:"female",label:"女"}],options2:[{value:"value1",label:"value1",children:[{value:"value2",label:"value2"},{value:"value3",label:"value3"}]}],imageUrl:"http://"+this.$HOST+"/common/showUserImage/"+this.$route.params.name+"?"+100*Math.random(),title:"Ranklist",image_loading:!1,info:{switch:!1,form:{infoRealName:"",infoSchoolName:"",infoPhone:"",infoGender:"man",infoBlog:null,infoGithub:null,infoMotto:null},rules:{infoPhone:[{validator:function(e,t,a){""==t||/^[1][3,4,5,7,8][0-9]{9}$/.test(t)?a():a(new Error("请输入正确的手机号"))},trigger:"change"}]}},username:{form:{disabled:!0,name:"",attention:"注意：用户名只能由_和英文字母开头,并且只能修改一次！"},rules:{name:[{min:5,max:10,message:"用户名必须在5-10个字符内",trigger:"change"}]}},pwd:{form:{oldPassword:"",password:"",password_:""},rules:{password:[{validator:function(e,t,a){t.length<6||t.length>15?a(new Error("密码必须在6-16位之间")):/^[0-9]{6,16}$|^[a-zA-Z]{6,16}$/.test(t)?a(new Error("密码太弱！您的密码全部都是数字或者字母")):a()},trigger:"change"}],password_:[{validator:function(t,a,s){""==a?s(new Error("当前区域必须填写")):a!=e.pwd.form.password?s(new Error("2次密码不匹配")):s()},trigger:"change"}]}},email:{form:{userEmail:"",captcha:""},rules:{userEmail:[{required:!0,type:"email",message:"邮箱填写不正确",trigger:"change"}],captcha:[{validator:function(e,t,a){""==t?a(new Error("当前区域必须填写")):/^\-??\d{1,4}$/.test(t)?a():a(new Error("验证码只能是数字，且只有1-4个数字"))},trigger:"change"}]}}}},computed:n()({},Object(p.c)(["user","image"])),methods:n()({},Object(p.b)(["UPDATE","UPDATE_IMAGE"]),{changeCaptcha:function(){this.captcha="http://"+this.$HOST+"/common/captcha?"+1e4*Math.random()},updatePassword:function(t){var a=this;this.$refs[t].validate(function(s){if(s){var o={oldPassword:a.pwd.form.oldPassword,userPwd:a.pwd.form.password};e.ajax({type:"post",xhrFields:{withCredentials:a.$CORS},crossDomain:a.$CORS,url:"http://"+a.$HOST+"/userPrivate/savePassword",dataType:"json",data:o,success:function(e){if(null!=e.success){a.$refs[t].resetFields();a.UPDATE({userName:"guest",userGrant:"0"}),a.$message({type:"success",message:e.success}),a.$router.push("/account")}else null!=e.error&&a.$message({type:"error",message:e.error})},error:function(e){a.$message({type:"error",message:null==e.responseJSON?"系统错误":e.responseJSON.message})}})}})},updateEmail:function(t){var a=this;this.$refs[t].validate(function(s){s&&e.ajax({type:"post",xhrFields:{withCredentials:a.$CORS},crossDomain:a.$CORS,url:"http://"+a.$HOST+"/userPrivate/saveEmail",dataType:"json",data:a.email.form,success:function(e){null!=e.success?(a.$refs[t].resetFields(),a.$message({type:"success",message:e.success})):null!=e.error&&a.$message({type:"error",message:e.error})},error:function(e){a.$message({type:"error",message:null==e.responseJSON?"系统错误":e.responseJSON.message})}})})},updateInfo:function(t){var a=this;this.$refs[t].validate(function(s){if(s){var o=JSON.parse(r()(a.info));o.form.infoSchoolName=r()(o.form.infoSchoolName),e.ajax({type:"post",xhrFields:{withCredentials:a.$CORS},crossDomain:a.$CORS,url:"http://"+a.$HOST+"/userPrivate/saveInfo",dataType:"json",data:o.form,success:function(e){null!=e.success?(a.$refs[t].resetFields(),a.$message({type:"success",message:e.success})):null!=e.error&&a.$message({type:"error",message:e.error})},error:function(e){a.$message({type:"error",message:null==e.responseJSON?"系统错误":e.responseJSON.message})}})}})},loadUsername:function(){null!=this.user&&"guest"!=this.user.userName?(this.loading=!1,e("#upload").on("change",function(e){document.getElementById("tmpbtn").click()}),this.username.form.name=this.user.userName,"root"==this.user.userName?this.username.form.attention="您是root用户，不能修改用户名":0==this.user.isChange?this.username.form.disabled=!1:this.username.form.attention="您已经修改过一次，不能再次修改用户名"):(this.$message({type:"error",message:"您还没登录，请先登录"}),this.$router.push("/"))},loadInfo:function(){var t=this;for(var a in e.ajax({type:"get",url:"http://"+this.$STATIC+"/campus.json",success:function(e){t.options2=[];for(var a=0;a<e.campus.length;a++){var s;for(var o in e.campus[a])s=o;for(var r={label:s,value:s,children:[]},i=0;i<e.campus[a][s].length;i++){var n={label:e.campus[a][s][i],value:e.campus[a][s][i]};r.children.push(n)}t.options2.push(r)}}}),t.info.form)null!=this.user[a]&&""!=this.user[a]&&(t.info.form[a]=this.user[a])},saveUsername:function(){var t=this;"guest"!=this.username.form.name?e.ajax({type:"post",xhrFields:{withCredentials:this.$CORS},crossDomain:this.$CORS,url:"http://"+this.$HOST+"/userPrivate/saveUsername",data:{username:this.username.form.name},dataType:"json",success:function(e){null!=e.error?t.$message({type:"error",message:e.error}):null!=e.success&&(t.username.form.disabled=!0,t.$message({type:"success",message:e.success}))},error:function(e){t.$message({type:"error",message:null==e.responseJSON?"系统错误":e.responseJSON.message})}}):this.$message({type:"error",message:"你不能使用guest作为用户名"})},onloadBtn:function(){e("#upload").click()},saveBtn:function(t){var a=this;e.ajax({type:"post",xhrFields:{withCredentials:this.$CORS},crossDomain:this.$CORS,url:"http://"+this.$HOST+"/userPrivate/save",data:u,dataType:"json",success:function(e){null!=e.success?(a.UPDATE_IMAGE("http://"+a.$HOST+"/common/showUserImage/"+a.$route.params.name+"?"+1e4*Math.random()),a.$message({type:"success",message:"已完成！"})):null!=e.error&&a.$message({type:"error",message:e.error})},error:function(e){a.$message({type:"error",message:null==e.responseJSON?"系统错误":e.responseJSON.message})}})},imageLoad:function(){var e;null!=s&&s.destroy(),e=document.querySelector("#image_"),s=new m.a(e,{viewMode:3,dragMode:"none",aspectRatio:1,background:!1,autoCropArea:.75,minContainerHeight:150,minContainerWidth:150,crop:function(e){u.x=parseInt(e.detail.x),u.y=parseInt(e.detail.y),u.w=parseInt(e.detail.width),u.h=parseInt(e.detail.height)}}),this.image_loading=!1},upload:function(){var t=this,a=document.getElementById("upload").files[0],s=a.name;if(/.png$|.jpg|.jpeg/.test(s)&&a.size<5242880){this.image_loading=!0;var o=new FormData;o.append("image",a),e.ajax({type:"post",xhrFields:{withCredentials:this.$CORS},crossDomain:this.$CORS,url:"http://"+this.$HOST+"/userPrivate/upload",data:o,cache:!1,processData:!1,contentType:!1,dataType:"json",success:function(a){null!=a.success?(t.$message({type:"success",message:a.success}),t.imageUrl="http://"+t.$HOST+"/common/showRepImage/"+t.$route.params.name+"?"+1e3*Math.random(),e("#saveBtn").removeAttr("disabled").removeClass("is-disabled")):null!=a.error&&t.$message({type:"error",message:a.error})},error:function(e){t.$message({type:"error",message:null==e.responseJSON?"系统错误":e.responseJSON.message})}})}else this.$message({type:"error",message:"您上传文件类型不匹配，请上传.png .jpg .jpeg"})}}),mounted:function(){this.loadInfo(),this.loadUsername()}}}).call(t,a("7t+N"))}});